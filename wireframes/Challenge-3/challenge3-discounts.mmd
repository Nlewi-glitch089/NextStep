%% Challenge 3: Discount Calculation Pipeline
graph TD
    A[Cart Item] --> B[Product Discount Rules]
    B --> C{Has Percentage Discount?}
    C -->|Yes| D[Check Min Quantity]
    C -->|No| E[No Discount Applied]
    
    D --> F{Meets Min Quantity?}
    F -->|Yes| G[Check Valid Until Date]
    F -->|No| E
    
    G --> H{Still Valid?}
    H -->|Yes| I[Apply Percentage Discount]
    H -->|No| E
    
    I --> J[Calculate Discount Amount]
    J --> K[Return Discount Value]
    E --> L[Return Zero Discount]
    
    K --> M[Final Item Total Calculation]
    L --> M
    
    M --> N[Update Cart Totals]
    N --> O[Trigger Price Update Events]